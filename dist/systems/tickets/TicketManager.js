const a39_0x3f3f15=a39_0x21f3;(function(_0x141c4b,_0x385825){const _0x16369e=a39_0x21f3,_0x471f18=_0x141c4b();while(!![]){try{const _0x4e632a=-parseInt(_0x16369e(0xd2))/0x1*(parseInt(_0x16369e(0x114))/0x2)+parseInt(_0x16369e(0x105))/0x3*(parseInt(_0x16369e(0x117))/0x4)+-parseInt(_0x16369e(0xf5))/0x5+parseInt(_0x16369e(0x10e))/0x6+-parseInt(_0x16369e(0x108))/0x7+-parseInt(_0x16369e(0xc0))/0x8*(parseInt(_0x16369e(0xe0))/0x9)+parseInt(_0x16369e(0xc6))/0xa*(parseInt(_0x16369e(0xec))/0xb);if(_0x4e632a===_0x385825)break;else _0x471f18['push'](_0x471f18['shift']());}catch(_0x506772){_0x471f18['push'](_0x471f18['shift']());}}}(a39_0x21bb,0xd3a24));function a39_0x21f3(_0x2bb721,_0x48f08d){const _0x21bb4f=a39_0x21bb();return a39_0x21f3=function(_0x21f36d,_0x4213da){_0x21f36d=_0x21f36d-0xae;let _0x4c0a12=_0x21bb4f[_0x21f36d];return _0x4c0a12;},a39_0x21f3(_0x2bb721,_0x48f08d);}function a39_0x21bb(){const _0x50d01e=['Invalid\x20ticket\x20category.','createdAt','tag','description','26686GNwaQA','ticketCooldowns','partnership','Danger','userId','Description','ViewChannel','generateTranscript','category','7823515ujCDCv','setLabel','handleTicketModalSubmit','Ephemeral','setTitle','>\x20Welcome\x20to\x20your\x20ticket!','username','reply','Ticket\x20Category','instance','edit','claim_ticket_btn','roles','setPlaceholder','[No\x20content]','\x20Ticket','3563031ECMvlS','categories','Ticket\x20Transcript\x20for\x20#','5485753frDGbK','other','channelId','Choose\x20a\x20ticket\x20category...','showModal','some','4581696Fereun','Primary','author','ticket_category_select','Attachments:\x20','commission','204452bWMuou','channel','handleTicketCategorySelect','4aPlunX','Support','messages','setEmoji','push','Partnership','values','Please\x20describe\x20your\x20issue\x20or\x20request...','Close\x20Ticket','OPEN','setCustomId','toISOString','closed-','ticket_modal','cache','Failed\x20to\x20create\x20ticket\x20channel.','user','url','fields','attachments','Founder','Ticket\x20created\x20in\x20','ReadMessageHistory','create','üõ°Ô∏è','close_ticket_btn','findOne','close','client','üé´\x20Open\x20a\x20Ticket','24OgXTzL','channels','**Category:**\x20','addOptions','Claim\x20Ticket','addComponents','5730uIaaIC','handleCloseTicket','\x0a**Created\x20by:**\x20<@','getTextInputValue','LeadManager','createTicketMessage','Paragraph','This\x20ticket\x20has\x20already\x20been\x20claimed.','name','send','SendMessages','setStyle','1GlUpCI','COOLDOWN_DURATION','ticket-','This\x20ticket\x20has\x20been\x20closed\x20by\x20','join','This\x20ticket\x20has\x20been\x20claimed\x20by\x20','has','Create\x20a\x20Ticket','title','handleClaimTicket','guild','createdTimestamp','Could\x20not\x20find\x20ticket\x20information.','GuildText','71793JURpwH','Moderator','getInstance','Bug\x20Report','üëã\x20Ticket\x20Claimed','support','\x0aCreated\x20at:\x20','claimedBy'];a39_0x21bb=function(){return _0x50d01e;};return a39_0x21bb();}import{ButtonBuilder,ActionRowBuilder,ButtonStyle,ChannelType,StringSelectMenuBuilder,ModalBuilder,TextInputBuilder,TextInputStyle,MessageFlags}from'discord.js';import{serverIds}from'../../config/serverIds.js';import{makeEmbed}from'../utils/embedUtils.js';import{TicketStatus,TICKET_TEMPLATES}from'./TicketTypes.js';import{Ticket}from'../../database/models/Ticket.js';export class TicketManager{static ['instance'];[a39_0x3f3f15(0xed)]=new Map();[a39_0x3f3f15(0xd3)]=0xa*0x3c*0x3e8;[a39_0x3f3f15(0xbe)];constructor(_0x2da286){const _0x215f05=a39_0x3f3f15;this[_0x215f05(0xbe)]=_0x2da286;}static[a39_0x3f3f15(0xe2)](_0x387cb9){const _0x216eb0=a39_0x3f3f15;return!TicketManager[_0x216eb0(0xfe)]&&(TicketManager[_0x216eb0(0xfe)]=new TicketManager(_0x387cb9)),TicketManager[_0x216eb0(0xfe)];}['isStaffMember'](_0x53610d){const _0x43c53a=a39_0x3f3f15,_0x59c146=[serverIds[_0x43c53a(0x101)][_0x43c53a(0xe1)]];return _0x59c146[_0x43c53a(0x10d)](_0x14fb2d=>_0x53610d[_0x43c53a(0xb0)][_0x43c53a(0xd8)](_0x14fb2d));}async[a39_0x3f3f15(0xf3)](_0x450db7){const _0x185ca7=a39_0x3f3f15,_0x3aab90=await _0x450db7[_0x185ca7(0x119)]['fetch']({'limit':0x64}),_0x33dc84=Array['from'](_0x3aab90[_0x185ca7(0x11d)]())['sort']((_0xa62fa1,_0x2b7eb3)=>_0xa62fa1[_0x185ca7(0xdd)]-_0x2b7eb3[_0x185ca7(0xdd)]);let _0x5e4dd7=_0x185ca7(0x107)+_0x450db7[_0x185ca7(0xce)]+_0x185ca7(0xe6)+_0x450db7[_0x185ca7(0xe9)]+'\x0a\x0a';for(const _0x9051a6 of _0x33dc84){const _0x1012f1=_0x9051a6[_0x185ca7(0xe9)][_0x185ca7(0x122)](),_0x3a659b=_0x9051a6[_0x185ca7(0x110)][_0x185ca7(0xea)],_0x3e6c3a=_0x9051a6['content']||_0x185ca7(0x103),_0x423c0c=_0x9051a6[_0x185ca7(0xb5)]['map'](_0x270bb2=>_0x270bb2[_0x185ca7(0xb3)])[_0x185ca7(0xd6)](',\x20');_0x5e4dd7+='['+_0x1012f1+']\x20'+_0x3a659b+':\x20'+_0x3e6c3a+'\x0a',_0x423c0c&&(_0x5e4dd7+=_0x185ca7(0x112)+_0x423c0c+'\x0a'),_0x5e4dd7+='\x0a';}return _0x5e4dd7;}async[a39_0x3f3f15(0xcb)](_0x51488c){const _0x1b10d4=a39_0x3f3f15,_0xde0a3=makeEmbed({'title':_0x1b10d4(0xbf),'description':'Select\x20a\x20category\x20below\x20to\x20open\x20a\x20ticket.'}),_0xfd60c9=new StringSelectMenuBuilder()[_0x1b10d4(0x121)](_0x1b10d4(0x111))['setPlaceholder'](_0x1b10d4(0x10b))[_0x1b10d4(0xc3)]([{'label':_0x1b10d4(0xe3),'value':'bug_report','emoji':'üêõ'},{'label':'Commission','value':_0x1b10d4(0x113),'emoji':'üíº'},{'label':_0x1b10d4(0x11c),'value':_0x1b10d4(0xee),'emoji':'ü§ù'},{'label':_0x1b10d4(0x118),'value':_0x1b10d4(0xe5),'emoji':'‚ùì'},{'label':'Other','value':_0x1b10d4(0x109),'emoji':'üìù'}]),_0x49964c=new ActionRowBuilder()['addComponents'](_0xfd60c9);await _0x51488c['send']({'embeds':[_0xde0a3],'components':[_0x49964c]});}async[a39_0x3f3f15(0x116)](_0x8d93b5){const _0x571d5e=a39_0x3f3f15,_0x5b4d5e=_0x8d93b5[_0x571d5e(0x11d)][0x0],_0x34d3aa=TICKET_TEMPLATES[_0x5b4d5e];if(!_0x34d3aa){await _0x8d93b5['reply']({'content':_0x571d5e(0xe8),'flags':MessageFlags['Ephemeral']});return;}const _0x10c607=await _0x8d93b5[_0x571d5e(0xdc)]?.[_0x571d5e(0xc1)][_0x571d5e(0xb9)]({'name':_0x571d5e(0xd4)+_0x8d93b5[_0x571d5e(0xb2)][_0x571d5e(0xfb)],'type':ChannelType[_0x571d5e(0xdf)],'parent':serverIds[_0x571d5e(0x106)][_0x571d5e(0xe5)],'permissionOverwrites':[{'id':_0x8d93b5[_0x571d5e(0xdc)]['id'],'deny':[_0x571d5e(0xf2)]},{'id':_0x8d93b5['user']['id'],'allow':[_0x571d5e(0xf2),_0x571d5e(0xd0),'ReadMessageHistory']},{'id':serverIds['roles'][_0x571d5e(0xb6)],'allow':[_0x571d5e(0xf2),_0x571d5e(0xd0),_0x571d5e(0xb8)]},{'id':serverIds['roles'][_0x571d5e(0xca)],'allow':['ViewChannel','SendMessages',_0x571d5e(0xb8)]},{'id':serverIds[_0x571d5e(0x101)]['CommunityManager'],'allow':[_0x571d5e(0xf2),_0x571d5e(0xd0),_0x571d5e(0xb8)]},{'id':serverIds[_0x571d5e(0x101)][_0x571d5e(0xe1)],'allow':[_0x571d5e(0xf2),_0x571d5e(0xd0),_0x571d5e(0xb8)]}]});if(!_0x10c607){await _0x8d93b5[_0x571d5e(0xfc)]({'content':_0x571d5e(0xb1),'flags':MessageFlags[_0x571d5e(0xf8)]});return;}await Ticket['create']({'id':_0x10c607['id'],'userId':_0x8d93b5['user']['id'],'channelId':_0x10c607['id'],'category':_0x5b4d5e,'status':TicketStatus[_0x571d5e(0x120)],'createdAt':new Date(),'updatedAt':new Date()});const _0x22c8c1=makeEmbed({'title':_0x34d3aa['title']+'\x20Ticket','description':_0x571d5e(0xc2)+_0x34d3aa[_0x571d5e(0xda)]+_0x571d5e(0xc8)+_0x8d93b5[_0x571d5e(0xb2)]['id']+'>'});await _0x10c607[_0x571d5e(0xcf)]({'content':'<@'+_0x8d93b5[_0x571d5e(0xb2)]['id']+_0x571d5e(0xfa),'embeds':[_0x22c8c1]}),await _0x8d93b5[_0x571d5e(0xfc)]({'content':_0x571d5e(0xb7)+_0x10c607,'flags':MessageFlags['Ephemeral']});}async['handleTicketButtonClick'](_0x28f5b5){const _0x5b9dcc=a39_0x3f3f15,_0x6b63c8=new ModalBuilder()[_0x5b9dcc(0x121)](_0x5b9dcc(0xaf))[_0x5b9dcc(0xf9)](_0x5b9dcc(0xd9)),_0x25abc7=new TextInputBuilder()[_0x5b9dcc(0x121)](_0x5b9dcc(0xf4))[_0x5b9dcc(0xf6)](_0x5b9dcc(0xfd))[_0x5b9dcc(0xd1)](TextInputStyle['Short'])['setPlaceholder']('Input\x20your\x20issue\x20or\x20request...')['setRequired'](!![]),_0x52ffca=new TextInputBuilder()[_0x5b9dcc(0x121)](_0x5b9dcc(0xeb))[_0x5b9dcc(0xf6)](_0x5b9dcc(0xf1))['setStyle'](TextInputStyle[_0x5b9dcc(0xcc)])[_0x5b9dcc(0x102)](_0x5b9dcc(0x11e))['setRequired'](!![]),_0x2be2da=new ActionRowBuilder()['addComponents'](_0x25abc7),_0x59c0a4=new ActionRowBuilder()[_0x5b9dcc(0xc5)](_0x52ffca);_0x6b63c8[_0x5b9dcc(0xc5)](_0x2be2da,_0x59c0a4),await _0x28f5b5[_0x5b9dcc(0x10c)](_0x6b63c8);}async[a39_0x3f3f15(0xf7)](_0x241688){const _0x3f8169=a39_0x3f3f15,_0x2c240e=_0x241688[_0x3f8169(0xb4)]['getTextInputValue'](_0x3f8169(0xf4)),_0x950db3=_0x241688[_0x3f8169(0xb4)][_0x3f8169(0xc9)](_0x3f8169(0xeb)),_0x3b6cbd=TICKET_TEMPLATES[_0x2c240e];if(!_0x3b6cbd){await _0x241688[_0x3f8169(0xfc)]({'content':'Invalid\x20ticket\x20category.','flags':MessageFlags['Ephemeral']});return;}const _0x55efe1=await _0x241688['guild']?.['channels']['create']({'name':_0x3f8169(0xd4)+_0x241688[_0x3f8169(0xb2)]['username'],'type':ChannelType[_0x3f8169(0xdf)],'parent':serverIds['categories'][_0x3f8169(0xe5)],'permissionOverwrites':[{'id':_0x241688[_0x3f8169(0xdc)]['id'],'deny':['ViewChannel']},{'id':_0x241688['user']['id'],'allow':[_0x3f8169(0xf2),_0x3f8169(0xd0),'ReadMessageHistory']},{'id':serverIds['roles'][_0x3f8169(0xb6)],'allow':[_0x3f8169(0xf2),'SendMessages',_0x3f8169(0xb8)]},{'id':serverIds[_0x3f8169(0x101)][_0x3f8169(0xca)],'allow':[_0x3f8169(0xf2),_0x3f8169(0xd0),_0x3f8169(0xb8)]},{'id':serverIds[_0x3f8169(0x101)]['CommunityManager'],'allow':[_0x3f8169(0xf2),_0x3f8169(0xd0),_0x3f8169(0xb8)]},{'id':serverIds[_0x3f8169(0x101)]['Moderator'],'allow':['ViewChannel',_0x3f8169(0xd0),'ReadMessageHistory']}]});if(!_0x55efe1){await _0x241688['reply']({'content':'Failed\x20to\x20create\x20ticket\x20channel.','flags':MessageFlags['Ephemeral']});return;}await Ticket['create']({'id':_0x55efe1['id'],'userId':_0x241688[_0x3f8169(0xb2)]['id'],'channelId':_0x55efe1['id'],'category':_0x2c240e,'status':TicketStatus[_0x3f8169(0x120)],'createdAt':new Date(),'updatedAt':new Date()});const _0x5f3dda=makeEmbed({'title':_0x3b6cbd[_0x3f8169(0xda)]+_0x3f8169(0x104),'description':_0x3f8169(0xc2)+_0x3b6cbd[_0x3f8169(0xda)]+_0x3f8169(0xc8)+_0x241688[_0x3f8169(0xb2)]['id']+'>'}),_0x1ff0dc=new ButtonBuilder()['setCustomId'](_0x3f8169(0x100))[_0x3f8169(0xf6)]('Claim\x20Ticket')[_0x3f8169(0xd1)](ButtonStyle[_0x3f8169(0x10f)])[_0x3f8169(0x11a)]('üëã'),_0xa06c2e=new ButtonBuilder()[_0x3f8169(0x121)](_0x3f8169(0xbb))[_0x3f8169(0xf6)](_0x3f8169(0x11f))[_0x3f8169(0xd1)](ButtonStyle[_0x3f8169(0xef)])[_0x3f8169(0x11a)]('üîí'),_0x1e4379=new ActionRowBuilder()['addComponents'](_0x1ff0dc,_0xa06c2e);await _0x55efe1[_0x3f8169(0xcf)]({'content':'<@'+_0x241688['user']['id']+_0x3f8169(0xfa),'embeds':[_0x5f3dda],'components':[_0x1e4379]}),await _0x241688[_0x3f8169(0xfc)]({'content':_0x3f8169(0xb7)+_0x55efe1,'flags':MessageFlags['Ephemeral']});}async[a39_0x3f3f15(0xdb)](_0x18c41c){const _0x53ebba=a39_0x3f3f15,_0x4aabcd=await Ticket['findOne']({'where':{'channelId':_0x18c41c[_0x53ebba(0x10a)]}});if(!_0x4aabcd){await _0x18c41c['reply']({'content':'Could\x20not\x20find\x20ticket\x20information.','flags':MessageFlags[_0x53ebba(0xf8)]});return;}if(_0x4aabcd[_0x53ebba(0xe7)]){await _0x18c41c[_0x53ebba(0xfc)]({'content':_0x53ebba(0xcd),'flags':MessageFlags[_0x53ebba(0xf8)]});return;}await _0x4aabcd['claim'](_0x18c41c[_0x53ebba(0xb2)]['id']);const _0x119c15=makeEmbed({'title':_0x53ebba(0xe4),'description':_0x53ebba(0xd7)+_0x18c41c[_0x53ebba(0xb2)]['tag'],'color':0x3498db});await _0x18c41c[_0x53ebba(0xfc)]({'embeds':[_0x119c15]});}async[a39_0x3f3f15(0xc7)](_0x57f6b0){const _0x22fd93=a39_0x3f3f15,_0x42a265=await Ticket[_0x22fd93(0xbc)]({'where':{'channelId':_0x57f6b0[_0x22fd93(0x10a)]}});if(!_0x42a265){await _0x57f6b0[_0x22fd93(0xfc)]({'content':_0x22fd93(0xde),'flags':MessageFlags[_0x22fd93(0xf8)]});return;}await _0x42a265[_0x22fd93(0xbd)](_0x57f6b0[_0x22fd93(0xb2)]['id']);const _0x268197=makeEmbed({'title':'üîí\x20Ticket\x20Closed','description':_0x22fd93(0xd5)+_0x57f6b0[_0x22fd93(0xb2)][_0x22fd93(0xea)],'color':0xe74c3c});await _0x57f6b0[_0x22fd93(0xfc)]({'embeds':[_0x268197]});const _0xbfc076=_0x57f6b0[_0x22fd93(0x115)];await _0xbfc076[_0x22fd93(0xff)]({'name':_0x22fd93(0xae)+_0xbfc076[_0x22fd93(0xce)],'permissionOverwrites':[{'id':_0x57f6b0['guild']['id'],'deny':[_0x22fd93(0xd0),_0x22fd93(0xf2)]},{'id':_0x42a265[_0x22fd93(0xf0)],'deny':[_0x22fd93(0xd0)],'allow':['ViewChannel',_0x22fd93(0xb8)]}]});}['createTicketButtons'](_0x538381=![]){const _0x2b3e98=a39_0x3f3f15,_0x8cb003=[];return!_0x538381&&_0x8cb003[_0x2b3e98(0x11b)](new ButtonBuilder()[_0x2b3e98(0x121)](_0x2b3e98(0x100))[_0x2b3e98(0xf6)](_0x2b3e98(0xc4))[_0x2b3e98(0xd1)](ButtonStyle[_0x2b3e98(0x10f)])[_0x2b3e98(0x11a)](_0x2b3e98(0xba))),_0x8cb003[_0x2b3e98(0x11b)](new ButtonBuilder()['setCustomId'](_0x2b3e98(0xbb))[_0x2b3e98(0xf6)](_0x2b3e98(0x11f))[_0x2b3e98(0xd1)](ButtonStyle[_0x2b3e98(0xef)])[_0x2b3e98(0x11a)]('üîí')),new ActionRowBuilder()[_0x2b3e98(0xc5)](_0x8cb003);}}